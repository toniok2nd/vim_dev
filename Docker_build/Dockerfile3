# Stage 2: Create the final image
FROM alpine:latest

# Install runtime dependencies
RUN apk --no-cache add libgcc libstdc++ tmux curl ranger git bash vim

# Install additional dependencies for coc.vim
RUN apk --no-cache add nodejs npm yarn

# Install vim-plug for plugin management
RUN mkdir -p ~/.vim/autoload ~/.vim/plugged \
    && wget -O ~/.vim/autoload/plug.vim https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

RUN mkdir -p /home/toniok/.vim/autoload ~/.vim/plugged \
    && wget -O /home/toniok/.vim/autoload/plug.vim https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

COPY vimrcFile /root/.vimrc
COPY tmuxFile /root/.tmux.conf
COPY vimrcFile /home/toniok/.vimrc
COPY tmuxFile /home/toniok/.tmux.conf

# Copy the coc.vim configuration file
COPY coc-settings.json /home/toniok/.vim/coc-settings.json


# Install coc.vim plugins
#RUN vim +PlugInstall +qall
#RUN /bin/sh -c 'echo "q" |vim +PlugInstall +qall || true'

# Install dependencies, including yarn
#RUN vim -c 'CocInstall -sync coc-json coc-html coc-jedi|q'
#RUN vim -es -u /root/.vimrc -i NONE -c "PlugInstall" -c "qa"
#RUN vim -E -s -u /root/.vimrc +PlugInstall +qall || true

# Run Vim when the container starts
CMD ["vim"]

